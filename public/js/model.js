const questionsData = {
    rompehielos: { truths: ["Si pudieras tener un superpoder, ¿cuál sería?", "¿Cuál es la comida más rara que has probado?", "Si pudieras cenar con cualquier personaje histórico, ¿quién sería?", "Si tuvieras que ser un animal, ¿cuál serías y por qué?", "¿Cuál fue el último libro que leíste?", "¿Qué es lo más amable que alguien ha hecho por ti?", "¿Cuál es tu talento más inútil?", "¿Qué canción siempre te pone de buen humor?", "Si pudieras vivir en cualquier época, ¿cuál elegirías?", "¿Cuál es el mejor regalo que has recibido?", "¿Cuál es la aplicación de tu móvil que más usas?", "Si solo pudieras comer una cosa por el resto de tu vida, ¿qué sería?", "¿Cuál es tu recuerdo más feliz de la infancia?", "¿Qué es algo que siempre te hace reír sin importar qué?", "Si pudieras ser un experto instantáneo en cualquier campo, ¿cuál elegirías?", "¿Crees en fantasmas o en lo paranormal?", "¿Cuál es el trabajo de tus sueños?", "Si pudieras diseñar una atracción de un parque temático, ¿cómo sería?", "¿Qué es algo que la mayoría de la gente no sabe sobre ti?", "¿Prefieres la playa o la montaña? ¿Por qué?"], dares: ["Haz tu mejor imitación de un animal.", "Habla como un pirata hasta tu próximo turno.", "Crea un apretón de manos secreto con la persona de tu derecha.", "Intenta hacer beatbox durante 30 segundos.", "Nombra 5 cosas que podrías comprar en un supermercado que empiecen con la letra 'P'.", "Usa un cojín como si fuera tu mascota por el resto del juego.", "Haz una pose de superhéroe y mantenla por un minuto.", "Canta el estribillo de una canción muy cursi.", "Intenta tocarte la nariz con la lengua.", "Habla con susurros hasta tu próximo turno.", "Intenta dibujar un círculo perfecto con tu mano no dominante.", "Hazle cosquillas a la persona a tu derecha durante 15 segundos.", "Canta el estribillo de la canción infantil que más recuerdes.", "Haz una imitación de tu emoji favorito.", "Intenta mantener el equilibrio sobre un pie con los ojos cerrados durante 30 segundos.", "Propón un brindis muy solemne por el objeto más insignificante de la mesa.", "Intenta hacer reír a la persona más seria del grupo.", "Lee el último mensaje de texto que recibiste en voz alta.", "Haz diez saltos de tijera mientras cantas tu canción favorita.", "Habla como Yoda hasta tu próximo turno."] },
    classic: { truths: ["¿Cuál es la cosa más vergonzosa que te ha pasado en una cita?", "¿Alguna vez has mentido en tu currículum?", "¿Cuál es el rumor más loco que has oído sobre ti?", "¿Has espiado el móvil de tu pareja?", "Si tuvieras que besar a alguien en esta sala, ¿quién sería?", "¿Qué es lo más ilegal que has hecho?", "¿Has roto algo en casa de alguien y no lo has dicho?", "¿Cuál es tu mayor 'red flag' en una pareja?", "¿Te has hecho pasar por enfermo para evitar un compromiso?", "¿Alguna vez te ha gustado la pareja de un amigo?", "¿Alguna vez te has meado en una piscina siendo adulto?", "¿Cuál es el regalo más feo que has recibido y has fingido que te encantaba?", "¿Has tenido alguna vez un sueño erótico con alguien presente?", "¿Qué es lo más vergonzoso que tus padres te han pillado haciendo?", "Si tuvieras que borrar una red social para siempre, ¿cuál sería?", "¿Alguna vez has culpado a alguien por algo que tú hiciste?", "¿Qué es lo más estúpido por lo que has discutido con una pareja?", "¿Revisas el perfil de tu ex en redes sociales?", "¿Cuál es tu 'Guilty Pleasure' musical?", "¿Te has comido algo que se te cayó al suelo aplicando la 'regla de los 5 segundos'?"], dares: ["Llama a un contacto al azar y intenta venderle un producto imaginario.", "Deja que el grupo te ponga un apodo vergonzoso para el resto de la noche.", "Haz una imitación de alguien famoso hasta que los demás adivinen.", "Publica una foto de tus pies en tus redes sociales.", "Intercambia una prenda de ropa con la persona a tu izquierda.", "Haz una llamada en broma a una tienda.", "Envía 'te echo de menos' al tercer contacto de tu WhatsApp.", "Actúa como si estuvieras borracho por las próximas 2 rondas.", "Come una cucharada de un condimento de la nevera.", "Haz 20 sentadillas mientras nombras personajes de Disney.", "Envía un mensaje a tu crush (o ex) diciendo 'estaba pensando en ti'.", "Ponte un cubito de hielo en el pantalón y aguanta hasta que se derrita.", "Haz una pasarela de moda improvisada mostrando tu 'look' de hoy.", "Deja que el grupo escriba una palabra en tu frente. No puedes verla hasta el final del juego.", "Haz 20 flexiones o sentadillas.", "Come una rodaja de limón o lima sin hacer ninguna mueca.", "Deja que alguien te haga cosquillas en los pies por 30 segundos.", "Hazle una broma telefónica a un amigo que no esté en la fiesta.", "Quítate los calcetines y úsalos como guantes por el resto de la ronda.", "Canta una canción de cuna a una almohada."] },
    sinfiltro: { truths: ["¿Con quién de los presentes has fantaseado?", "¿Cuál es el lugar más público donde has tenido relaciones?", "¿Alguna vez has estado con más de una persona a la vez?", "¿Qué es lo más 'kinky' que has probado?", "Muestra el último vídeo porno que viste.", "¿Cuál es tu postura sexual favorita y por qué?", "¿Has usado juguetes sexuales? Describe tu favorito.", "Confiesa una infidelidad (propia o que conozcas de cerca).", "¿Qué es lo que más te excita de la persona a tu derecha?", "¿Te has acostado con la ex pareja de un amigo/a?", "¿Qué es lo más rápido que has tardado en acostarte con alguien desde que lo conociste?", "¿Alguna vez te han pillado masturbándote?", "¿Has tenido sexo en casa de tus padres mientras ellos estaban allí?", "Describe el orgasmo más intenso que has tenido.", "¿Prefieres dominar o ser dominado/a en la cama?", "¿Has probado el BDSM o alguna práctica similar?", "¿Qué es algo que te da vergüenza pedir en la cama pero que te encantaría probar?", "Si tuvieras que calificar tus habilidades como amante del 1 al 10, ¿qué nota te pondrías?", "¿Cuál es la mayor locura que has hecho por amor o por deseo?", "Describe el beso más memorable que has dado o recibido."], dares: ["Dale un beso francés de 20 segundos a alguien elegido por el grupo.", "Quítate una prenda de ropa.", "Haz un 'lap dance' de 30 segundos a la persona de tu elección.", "Deja que alguien te dé una nalgada.", "Chúpale el dedo a la persona que te parezca más sexy.", "Susúrrale al oído a alguien la descripción de lo que le harías en la cama.", "Elige a dos personas para que se den un beso (pico).", "Muerde suavemente el lóbulo de la oreja de la persona de tu izquierda.", "Quítale una prenda de ropa a alguien usando solo la boca.", "Haz un 'body shot' en el cuello o abdomen de alguien.", "Elige a una persona y quítale una prenda de ropa con la boca.", "Hazle un 'body shot' a alguien (sal, tequila/shot, limón).", "Elige a una persona. Ambos deben beber un trago mientras se miran fijamente a los ojos. El primero que se ría, bebe otro.", "Huele el cuello de cada jugador y adivina qué perfume o loción llevan.", "Quítate los pantalones y juega sin ellos durante 2 rondas.", "Dale de comer algo a alguien en la boca de forma sensual.", "Escribe el nombre de tu celebrity crush en el abdomen de alguien con tu dedo.", "Hazle una foto sexy a tu pie y ponla como foto de perfil de WhatsApp durante 10 minutos.", "Elige a una persona para que te susurre su fantasía más secreta. No puedes contársela a nadie.", "Haz un ranking de los jugadores de la sala según lo bien que crees que besan."] },
    prohibido: { truths: ["¿Con quién de esta sala tendrías el sexo más animal y por qué?", "¿Cuál es el secreto más oscuro que sabes de alguien presente?", "Describe la fantasía más tabú que tienes involucrando a alguien del grupo.", "¿Qué es lo más degradante que has hecho por placer?", "Si tuvieras que elegir, ¿te acostarías con la pareja de tu mejor amigo?", "Muestra al grupo la conversación más caliente que tengas en tu móvil.", "Describe con detalle la última vez que te masturbaste.", "¿Has tenido alguna vez una experiencia sexual que podría considerarse ilegal?", "¿Cuál es la parte del cuerpo de alguien en esta sala que más te gustaría lamer?", "¿Alguna vez has pagado por sexo?", "¿Cuál es la fantasía sexual más detallada que tienes con alguien de esta sala?", "¿Has tenido un orgasmo pensando en alguien que no debías?", "¿Qué es lo más vergonzoso que has hecho para satisfacerte sexualmente?", "¿Has espiado a alguien mientras se cambiaba o se duchaba?", "¿Cuál es la parte de tu propio cuerpo que más te excita?", "Si tuvieras que hacer un trío con dos personas de esta sala, ¿a quiénes elegirías?", "¿Cuál es el secreto de otro jugador que sabes que, si lo revelaras, cambiaría la dinámica del grupo?", "¿Has tenido sexo con más de una persona en un periodo de 24 horas?", "¿Qué es lo más cerca que has estado de engañar a tu pareja?", "¿Has tenido alguna vez una fantasía con alguien del mismo sexo? Describe la fantasía."], dares: ["Quítate la ropa hasta quedar en ropa interior y juega así hasta tu próximo turno.", "Elige a una persona. Tienes permiso para tocar sus genitales por encima de la ropa durante 30 segundos.", "Lame una línea de sal desde el cuello hasta el ombligo de otro jugador.", "Da un beso francés a cada persona en la sala.", "Intercambia una prenda de ropa interior con la persona de enfrente.", "Realiza un striptease de 1 minuto para el grupo.", "Deja que el grupo te vende los ojos y te dé besos en el cuello. Tienes que adivinar quién fue.", "Arrodíllate y actúa como la mascota de alguien por una ronda.", "Elige a dos personas. Tienen que meterse juntos en un armario por 5 minutos.", "El grupo escribe una palabra en una parte de tu cuerpo cubierta por la ropa. Tienes que adivinarla solo con el tacto.", "Elige a una persona. Ambos deben quitarse una prenda de ropa y ponérsela al otro.", "Besa a la persona de tu izquierda. El beso debe empezar en la mejilla y bajar hasta la clavícula.", "Elige a una persona. Tienes que quitarle los zapatos y los calcetines y masajearle los pies durante un minuto.", "Elige a dos jugadores. Deben meterse juntos en un armario o un espacio pequeño durante 3 minutos.", "Quítate la camiseta y deja que alguien dibuje algo en tu espalda con su dedo. Tienes que adivinar qué es.", "Dale una lamida al cuello de cada jugador presente.", "Elige a alguien. Tienen que darse de comer el uno al otro un trozo de fruta de la forma más erótica posible.", "Siéntate en el suelo. La persona a tu derecha tiene que pasar por encima de ti muy lentamente.", "Elige a alguien y dale un beso con los ojos vendados. El grupo te guiará hasta esa persona.", "Elige a la persona que peor te caiga del grupo y dale un beso en la boca."] }
};

const generalCards = [
    { type: 'wildcard', title: "El Imitador", description: "Elige a alguien y debes imitarlo durante 3 rondas. Si fallas, bebes." }, { type: 'wildcard', title: "Cascada", description: "¡Todos a beber! Empiezas tú y nadie para hasta que tú lo hagas." }, { type: 'wildcard', title: "Rey del Pulgar", description: "Eres el 'Thumb Master'. Pon tu pulgar en la mesa en cualquier momento. El último en copiarte, bebe." }, { type: 'bomb', title: "Shot en Cadena", description: "Tomas 1 shot puro. Luego, eliges a otro para que tome 2." }, { type: 'bomb', title: "Muro de la Vergüenza", description: "El grupo escribe un estado vergonzoso para que lo publiques en tus redes." }, { type: 'bomb', title: "El Exiliado", description: "No puedes hablar ni reír durante la próxima ronda. Si lo haces, bebes." }
];

const prohibitedCards = [
    { type: 'wildcard', title: "Círculo del Beso", description: "Empiezas tú, besas a la persona de tu derecha, y así sucesivamente. El último beso, de vuelta a ti, es con lengua." }, { type: 'wildcard', title: "Siete Minutos: Ropa Opcional", description: "Elige a alguien. Vayan a un cuarto por 7 minutos. Al menos una prenda principal debe ser retirada por cada uno." }, { type: 'wildcard', title: "Rey/Reina de la Noche", description: "Tienes el poder. Da UNA orden del Modo Prohibido a CUALQUIER jugador. No se puede negar." }, { type: 'bomb', title: "Confesión Forzada", description: "Entrega tu teléfono. El grupo tiene 3 minutos para leer en voz alta cualquier conversación que elijan." }, { type: 'bomb', title: "Ruleta de Ropa Interior", description: "Debes quitarte la ropa interior y dársela a la persona de tu izquierda. No la recuperas hasta el final." }, { type: 'bomb', title: "El Reto Definitivo", description: "El jugador anterior inventa un reto extremo para ti. No puedes negarte." }
];

const finalBombGeneral = {
    title: "El Camino del Campeón 🏆",
    description: "Para ganar, debes superar 3 mini-retos diseñados por los demás jugadores. Si fallas uno, pierdes 3 puntos y el juego continúa."
};

const finalBombProhibido = {
    title: "El Peaje del Placer 😈",
    description: "Para ganar, debes elegir una de dos opciones. Si te niegas a ambas, pierdes la mitad de tus puntos.",
    options: {
        a: "Opción A: La Ofrenda (Dar placer)",
        b: "Opción B: La Sumisión (Recibir placer)"
    }
};

const gameState = {
    mode: 'classic', players: [], turnOrder: [], currentPlayerIndex: 0, isCompetitive: false,
    customTruths: [], customDares: [], activeQuestions: { truth: [], dare: [] }, skipTurn: false
};

function _shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function _reloadQuestions() {
    const truths = questionsData[gameState.mode]?.truths || [];
    const dares = questionsData[gameState.mode]?.dares || [];
    gameState.activeQuestions.truth = [...truths, ...gameState.customTruths];
    gameState.activeQuestions.dare = [...dares, ...gameState.customDares];
    _shuffleArray(gameState.activeQuestions.truth);
    _shuffleArray(gameState.activeQuestions.dare);
}

export function setMode(newMode) { gameState.mode = newMode; }
export function setCompetitive(isCompetitive) { gameState.isCompetitive = isCompetitive; }
export function addPlayer(name, gender) {
    if (name && !gameState.players.find(p => p.name === name)) {
        gameState.players.push({ name, gender, drinks: 0, points: 0 });
        return true;
    }
    return false;
}
export function removePlayer(name) { gameState.players = gameState.players.filter(p => p.name !== name); }
export function addCustomQuestion(type, text) {
    if (type === 'truth') gameState.customTruths.push(text);
    else gameState.customDares.push(text);
}
export function prepareGame() {
    gameState.turnOrder = [...gameState.players];
    _shuffleArray(gameState.turnOrder);
    _reloadQuestions();
}
export function nextPlayer() { gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.turnOrder.length; }
export function getQuestion(type) {
    let pool = gameState.activeQuestions[type];
    if (pool.length === 0) {
        _reloadQuestions();
        pool = gameState.activeQuestions[type];
    }
    return pool.pop();
}
export function triggerCard() {
    let pool = gameState.mode === 'prohibido' ? [...generalCards, ...prohibitedCards] : generalCards;
    const card = pool[Math.floor(Math.random() * pool.length)];
    if(card.effect) card.effect(gameState);
    return card;
}
export function getFinalBomb() {
    if (gameState.isCompetitive) {
        const player = gameState.turnOrder[gameState.currentPlayerIndex];
        if (player.points >= 8) {
            if (Math.random() < 0.75) {
                return gameState.mode === 'prohibido' ? finalBombProhibido : finalBombGeneral;
            }
        }
    }
    return null;
}
export function addDrinkToCurrentPlayer() {
    const player = gameState.turnOrder[gameState.currentPlayerIndex];
    if (player) player.drinks++;
}
export function updatePointsForCurrentPlayer(wasSuccessful) {
    const player = gameState.turnOrder[gameState.currentPlayerIndex];
    if (player && wasSuccessful) player.points += 2;
}
export function getSkipPunishment() {
    switch (gameState.mode) {
        case 'sinfiltro': return "Debes tomar 2 SHOTS PUROS.";
        case 'prohibido': return "Debes tomar 3 SHOTS PUROS.";
        default: return "Debes tomar 1 SHOT PURO.";
    }
}
export function reset() {
    Object.assign(gameState, {
        mode: 'classic', players: [], turnOrder: [], currentPlayerIndex: 0, isCompetitive: false,
        customTruths: [], customDares: [], activeQuestions: { truth: [], dare: [] }, skipTurn: false
    });
}

export default gameState;